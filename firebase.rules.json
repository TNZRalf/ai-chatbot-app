{
  "rules": {
    "firestore.rules": {
      "rules_version": "2",
      "service": "cloud.firestore",
      "match /databases/{database}/documents": {
        // User profiles
        match /users/{userId} {
          allow read: if request.auth != null;
          allow write: if request.auth != null && request.auth.uid == userId;
        }
        
        // Messages
        match /messages/{messageId} {
          allow read: if request.auth != null && resource.data.userId == request.auth.uid;
          allow create: if request.auth != null;
          allow update, delete: if request.auth != null && resource.data.userId == request.auth.uid;
        }
      }
    },
    
    "storage.rules": {
      "rules_version": "2",
      "service": "firebase.storage",
      "match /b/{bucket}/o": {
        match /{allPaths=**} {
          allow read: if request.auth != null;
          allow write: if request.auth != null 
            && request.resource.size < 5 * 1024 * 1024 // 5MB
            && request.resource.contentType.matches('image/.*|application/pdf');
        }
      }
    }
  }
}
